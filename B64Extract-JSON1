function Extract-JsonContentSimple {
    param (
        [string]$FilePath,
        [string]$OutputPath = "extracted_output.txt"
    )
    
    Write-Host "Starting extraction process..."
    Write-Host "Input file: $FilePath"
    Write-Host "Output file: $OutputPath"
    
    # Check if file exists
    if (-not (Test-Path -Path $FilePath)) {
        Write-Host "ERROR: File not found: $FilePath"
        return
    }
    Write-Host "Input file found"
    
    # Read the file
    try {
        $fileContent = Get-Content -Path $FilePath -Raw
        Write-Host "File read successfully, length: $($fileContent.Length) characters"
    }
    catch {
        Write-Host "ERROR reading file: $_"
        return
    }
    
    # Find markers
    $startMarker = '{"rawLines":["'
    $endMarker = '"],'
    
    $startPos = $fileContent.IndexOf($startMarker)
    if ($startPos -eq -1) {
        Write-Host "ERROR: Start marker not found"
        return
    }
    Write-Host "Start marker found at position $startPos"
    
    # Adjust position to get content after marker
    $startPos += $startMarker.Length
    
    # Find end marker
    $endPos = $fileContent.IndexOf($endMarker, $startPos)
    if ($endPos -eq -1) {
        Write-Host "ERROR: End marker not found"
        return
    }
    Write-Host "End marker found at position $endPos"
    
    # Extract content
    $content = $fileContent.Substring($startPos, $endPos - $startPos)
    Write-Host "Content extracted, length: $($content.Length) characters"
    
    # Process content - replace escaped characters
    $lines = $content -split '","'
    Write-Host "Split into $($lines.Count) lines"
    
    # Create output
    try {
        $lines | Out-File -FilePath $OutputPath
        Write-Host "Output file created successfully at: $OutputPath"
    }
    catch {
        Write-Host "ERROR creating output file: $_"
    }
}